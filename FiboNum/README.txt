Рассчёты выполняются в массиве, т.к. обычный рассчёт захлёбывается по таймауту.